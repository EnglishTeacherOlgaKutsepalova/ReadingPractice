<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—Å—Ç –±—É–∫–≤: —Å—Ç—Ä–æ–π –∏ —á–∏—Ç–∞–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Rounded MT Bold', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        /* ==================== –ö–ê–†–¢–ê –ü–†–û–ì–†–ï–°–°–ê ==================== */
        .map-container {
            position: relative;
            height: 120px;
            margin-bottom: 30px;
            background: linear-gradient(to bottom, #87ceeb, #1e90ff);
            border-radius: 20px;
            overflow: hidden;
            padding: 20px;
        }

        .map-track {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #d4af37;
            transform: translateY(-50%);
            border-radius: 2px;
        }

        .map-points {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 20px;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        .map-point {
            width: 16px;
            height: 16px;
            background: #ff6b6b;
            border-radius: 50%;
            border: 3px solid white;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .map-point.completed {
            background: #4caf50;
            transform: scale(1.2);
        }

        .map-point.active {
            background: #2196f3;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.7);
        }

        .character {
            position: absolute;
            top: 50%;
            left: 5%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/character.png') center/contain no-repeat;
            transition: left 0.5s ease;
        }

        .progress-info {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #ff6b6b, #4caf50);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* ==================== –ò–ì–†–û–í–ê–Ø –û–ë–õ–ê–°–¢–¨ ==================== */
        .game-area {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .target-emoji-container {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .target-emoji {
            font-size: 120px;
            margin-bottom: 15px;
            display: block;
        }

        .speak-btn {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
            font-size: 24px;
            font-weight: bold;
        }

        .speak-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .speak-btn:active {
            transform: scale(0.95);
        }

        .target-word {
            margin-top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 3px;
            min-height: 40px;
        }

        /* ==================== –ú–û–°–¢ –ò –ë–õ–û–ö–ò ==================== */
        .bridge-base {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
            min-height: 100px;
            padding: 20px;
        }

        .bridge-slot {
            width: 100px;
            height: 100px;
            background: rgba(139, 69, 19, 0.2);
            border: 3px dashed #8b4513;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .bridge-slot.filled {
            background: rgba(139, 69, 19, 0.4);
            border-style: solid;
        }

        .letter-blocks-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            min-height: 150px;
        }

        .letter-block {
            width: 110px;
            height: 130px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 4px solid #d4af37;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            position: relative;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            user-select: none;
            overflow: hidden;
        }

        .letter-block:active {
            cursor: grabbing;
        }

        .letter-block.dragging {
            transform: scale(1.1) rotate(5deg);
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .letter-block.wrong {
            animation: shake 0.5s;
            border-color: #ff6b6b;
        }

        .letter-block.correct {
            border-color: #4caf50;
            transform: scale(1.05);
        }

        .letter-hint {
            width: 80px;
            height: 80px;
            margin-top: 5px;
            object-fit: contain;
            border-radius: 10px;
        }

        /* ==================== –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ==================== */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-check {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .attempts, .timer {
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* ==================== –§–ò–î–ë–ï–ö ==================== */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback.success {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
        }

        .feedback.error {
            background: linear-gradient(135deg, #ff6b6b, #c62828);
            color: white;
        }

        /* ==================== –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ==================== */
        .final-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .final-screen.active {
            display: flex;
        }

        .final-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .final-content h2 {
            color: white;
            margin-bottom: 30px;
            font-size: 32px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .final-stats {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
        }

        .final-stats p {
            font-size: 18px;
            margin: 10px 0;
        }

        .final-prize {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/medal.png') center/contain no-repeat;
        }

        .btn-restart {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            font-size: 20px;
            padding: 20px 50px;
        }

        /* ==================== –ê–ù–ò–ú–ê–¶–ò–ò ==================== */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
        }

        @keyframes bridgeBuild {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ==================== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ==================== */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            .map-container {
                height: 100px;
            }
            
            .target-emoji {
                font-size: 80px;
            }
            
            .speak-btn {
                width: 40px;
                height: 40px;
                top: -10px;
                right: -10px;
                font-size: 18px;
            }
            
            .letter-block {
                width: 85px;
                height: 105px;
            }
            
            .letter-hint {
                width: 60px;
                height: 60px;
            }
            
            .bridge-slot {
                width: 80px;
                height: 80px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="map-container">
            <div class="map-track"></div>
            <div class="map-points" id="mapPoints"></div>
            <div class="character" id="character"></div>
            <div class="progress-info">
                <span id="levelCounter">1/10</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>

        <div class="game-area">
            <div class="target-emoji-container">
                <div class="speak-btn" id="speakBtn">üîä</div>
                <div class="target-emoji" id="targetEmoji"></div>
                <div class="target-word" id="targetWordText"></div>
            </div>

            <div class="bridge-base" id="bridgeBase"></div>

            <div class="letter-blocks-container" id="letterBlocksContainer"></div>

            <div class="controls">
                <button class="btn btn-check" id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="btn btn-reset" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <div class="attempts" id="attemptsDisplay">–ü–æ–ø—ã—Ç–∫–∏: 3/3</div>
                <div class="timer" id="timerDisplay">–í—Ä–µ–º—è: 60—Å</div>
            </div>

            <div class="feedback" id="feedback"></div>
        </div>

        <div class="final-screen" id="finalScreen">
            <div class="final-content">
                <h2>üéâ –ú–æ–ª–æ–¥–µ—Ü! –¢—ã –ø–æ—Å—Ç—Ä–æ–∏–ª –≤—Å–µ –º–æ—Å—Ç—ã! üéâ</h2>
                <div class="final-stats">
                    <p>–°–ª–æ–≤ —Å–æ–±—Ä–∞–Ω–æ: <span id="totalWords"></span></p>
                    <p>–í—Ä–µ–º—è –∏–≥—Ä—ã: <span id="totalTime"></span></p>
                    <p>–û—à–∏–±–æ–∫: <span id="totalErrors"></span></p>
                </div>
                <div class="final-prize" id="finalPrize"></div>
                <button class="btn btn-restart" id="restartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>
        </div>

        <audio id="audioPlayer"></audio>
    </div>

    <script>
        // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –±—É–∫–≤
        const letterAssociations = {
            'a': 'apple', 'b': 'ball', 'c': 'cat', 'd': 'dog', 'e': 'egg',
            'f': 'frog', 'g': 'glass', 'h': 'hat', 'i': 'insect', 'j': 'jam',
            'k': 'kite', 'l': 'lemon', 'm': 'man', 'n': 'nest', 'o': 'orange',
            'p': 'pen', 'q': 'queen', 'r': 'ring', 's': 'star', 't': 'table',
            'u': 'umbrella', 'v': 'vase', 'w': 'woman', 'x': 'box', 'y': 'yellow', 'z': 'zebra'
        };

        // –ë–∞–∑–∞ —ç–º–æ–¥–∑–∏ –¥–ª—è —Å–ª–æ–≤
        const wordEmojis = {
            'ant': 'üêú', 'cat': 'üê±', 'dog': 'üê∂', 'sun': '‚òÄÔ∏è', 'hat': 'üé©',
            'pen': '‚úèÔ∏è', 'cup': '‚òï', 'egg': 'ü•ö', 'box': 'üì¶', 'bed': 'üõèÔ∏è',
            'apple': 'üçé', 'ball': '‚öΩ', 'frog': 'üê∏', 'glass': 'ü•õ', 'insect': 'üêõ',
            'jam': 'üçì', 'kite': 'ü™Å', 'lemon': 'üçã', 'man': 'üë®', 'nest': 'ü™π',
            'orange': 'üçä', 'queen': 'üëë', 'ring': 'üíç', 'star': '‚≠ê', 'table': 'ü™ë',
            'umbrella': '‚òî', 'vase': 'üè∫', 'woman': 'üë©', 'yellow': 'üü°', 'zebra': 'ü¶ì',
            'bee': 'üêù', 'car': 'üöó', 'duck': 'ü¶Ü', 'fish': 'üêü', 'goat': 'üêê',
            'house': 'üè†', 'ice': 'üßä', 'juice': 'üßÉ', 'key': 'üîë', 'lion': 'ü¶Å',
            'moon': 'üåô', 'nose': 'üëÉ', 'owl': 'ü¶â', 'pig': 'üê∑', 'princess': 'üë∏',
            'rose': 'üåπ', 'ship': 'üö¢', 'tree': 'üå≥', 'umbrella2': '‚òÇÔ∏è', 'van': 'üöê',
            'wolf': 'üê∫', 'yacht': '‚õµ', 'zoo': 'ü¶Å', 'bus': 'üöå', 'cow': 'üêÆ',
            'door': 'üö™', 'eye': 'üëÅÔ∏è', 'fan': 'üåÄ', 'grape': 'üçá', 'hand': '‚úã',
            'igloo': 'üè†', 'jacket': 'üß•', 'kangaroo': 'ü¶ò', 'leaf': 'üçÉ', 'mouse': 'üê≠',
            'nail': 'üíÖ', 'octopus': 'üêô', 'panda': 'üêº', 'quill': '‚úíÔ∏è', 'rabbit': 'üê∞',
            'snake': 'üêç', 'tiger': 'üêØ', 'unicorn': 'ü¶Ñ', 'violin': 'üéª', 'whale': 'üê≥',
            'yak': 'üêÉ', 'zebra2': 'ü¶ì', 'arm': 'üí™', 'bag': 'üéí', 'chair': 'ü™ë',
            'desk': 'üíº', 'ear': 'üëÇ', 'foot': 'ü¶∂', 'guitar': 'üé∏', 'hair': 'üíá',
            'icecream': 'üç¶', 'jelly': 'üçÆ', 'knight': '‚öîÔ∏è', 'lamp': 'üí°', 'mask': 'üé≠',
            'net': 'üé£', 'ocean': 'üåä', 'pizza': 'üçï', 'quilt': 'üõèÔ∏è', 'rock': 'ü™®',
            'sand': 'üèñÔ∏è', 'tent': '‚õ∫', 'up': '‚¨ÜÔ∏è', 'vest': 'üß•', 'water': 'üíß',
            'xylophone': 'üéµ', 'yogurt': 'ü•õ', 'zipper': 'üß•', 'zip': 'ü§ê', 'zip2': 'ü§ê'
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentLevel = 0;
        let levels = [];
        let attemptsLeft = 3;
        let timer = null;
        let secondsLeft = 60;
        let totalErrors = 0;
        let startTime = null;
        let gameConfig = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', () => {
            loadGameConfig();
            initGame();
        });

        function loadGameConfig() {
            const urlParams = new URLSearchParams(window.location.search);
            const configParam = urlParams.get('config');
            
            if (configParam) {
                try {
                    gameConfig = JSON.parse(atob(configParam));
                    setupGameFromConfig(gameConfig);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', e);
                    loadDefaultConfig();
                }
            } else {
                loadDefaultConfig();
            }
        }

        function loadDefaultConfig() {
            gameConfig = {
                attempts: 3,
                timer: 60,
                language: 'ru',
                character: 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/character.png',
                finalPrize: 'medal',
                words: ['ant', 'cat', 'dog', 'sun', 'hat', 'pen', 'cup', 'egg', 'box', 'bed']
            };
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤ –≤ —É—Ä–æ–≤–Ω–∏
            levels = gameConfig.words.map(word => ({
                word: word.toLowerCase(),
                emoji: wordEmojis[word.toLowerCase()] || '‚ùì',
                letters: getLettersForWord(word)
            }));
            
            attemptsLeft = gameConfig.attempts;
            secondsLeft = gameConfig.timer;
            document.querySelector('.character').style.backgroundImage = `url('${gameConfig.character}')`;
        }

        function getLettersForWord(word) {
            return word.toLowerCase().split('').map(letter => letter);
        }

        function setupGameFromConfig(config) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤ –≤ —É—Ä–æ–≤–Ω–∏
            levels = config.words.map(word => ({
                word: word.toLowerCase(),
                emoji: wordEmojis[word.toLowerCase()] || '‚ùì',
                letters: getLettersForWord(word)
            }));
            
            attemptsLeft = config.attempts || 3;
            secondsLeft = config.timer || 60;
            document.querySelector('.character').style.backgroundImage = `url('${config.character}')`;
            
            updateMapPoints();
        }

        function initGame() {
            startTime = Date.now();
            currentLevel = 0;
            totalErrors = 0;
            
            updateLevelCounter();
            updateMapPoints();
            loadLevel(currentLevel);
            
            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('resetBtn').addEventListener('click', resetLevel);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('speakBtn').addEventListener('click', () => speakWord(levels[currentLevel]?.word || ''));
            
            if (secondsLeft > 0) {
                startTimer();
            }
        }

        function loadLevel(levelIndex) {
            if (levelIndex >= levels.length) {
                showFinalScreen();
                return;
            }
            
            const level = levels[levelIndex];
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —ç–º–æ–¥–∑–∏ –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏
            document.getElementById('targetEmoji').textContent = level.emoji;
            document.getElementById('targetWordText').textContent = gameConfig.language === 'en' ? level.word : '';
            
            const bridgeBase = document.getElementById('bridgeBase');
            bridgeBase.innerHTML = '';
            
            for (let i = 0; i < level.word.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'bridge-slot';
                slot.dataset.index = i;
                bridgeBase.appendChild(slot);
            }
            
            const letterBlocksContainer = document.getElementById('letterBlocksContainer');
            letterBlocksContainer.innerHTML = '';
            
            const shuffledLetters = [...level.letters].sort(() => Math.random() - 0.5);
            
            shuffledLetters.forEach(letter => {
                const block = document.createElement('div');
                block.className = 'letter-block';
                block.draggable = true;
                block.dataset.letter = letter;
                
                const hintUrl = `https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/${letter}-hint.png`;
                
                // –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π, –±–µ–∑ –±—É–∫–≤—ã
                block.innerHTML = `
                    <img src="${hintUrl}" alt="${letterAssociations[letter]}" class="letter-hint" onerror="this.src='https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/placeholder.png'">
                `;
                
                block.addEventListener('dragstart', handleDragStart);
                block.addEventListener('dragend', handleDragEnd);
                
                letterBlocksContainer.appendChild(block);
            });
            
            document.querySelectorAll('.bridge-slot').forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('drop', handleDrop);
            });
            
            resetAttempts();
            updateMapPoints();
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('feedback').className = 'feedback';
        }

        let draggedBlock = null;

        function handleDragStart(e) {
            draggedBlock = this;
            setTimeout(() => {
                this.classList.add('dragging');
            }, 0);
            e.dataTransfer.setData('text/plain', this.dataset.letter);
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            this.classList.add('filled');
        }

        function handleDragLeave() {
            this.classList.remove('filled');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('filled');
            
            if (!this.querySelector('.letter-block') && draggedBlock) {
                const clonedBlock = draggedBlock.cloneNode(true);
                clonedBlock.draggable = false;
                clonedBlock.classList.remove('dragging');
                
                clonedBlock.addEventListener('click', () => {
                    this.removeChild(clonedBlock);
                    document.getElementById('letterBlocksContainer').appendChild(draggedBlock);
                });
                
                this.appendChild(clonedBlock);
                draggedBlock.remove();
            }
        }

        function checkAnswer() {
            const slots = document.querySelectorAll('.bridge-slot');
            const answer = Array.from(slots)
                .map(slot => slot.querySelector('.letter-block')?.dataset.letter || '')
                .join('');
            
            const correctWord = levels[currentLevel].word;
            
            if (answer === correctWord) {
                showFeedback('success', gameConfig.language === 'en' ? 'Well done!' : '–û—Ç–ª–∏—á–Ω–æ!');
                playSound('success');
                speakWord(correctWord);
                
                setTimeout(() => {
                    animateBridgeBuild();
                }, 500);
                
                setTimeout(() => {
                    currentLevel++;
                    if (currentLevel < levels.length) {
                        moveCharacter();
                        loadLevel(currentLevel);
                    } else {
                        showFinalScreen();
                    }
                }, 1500);
            } else {
                totalErrors++;
                attemptsLeft--;
                
                if (attemptsLeft <= 0 && gameConfig.attempts > 0) {
                    showFeedback('error', gameConfig.language === 'en' ? 'Game Over! Try again.' : '–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                    setTimeout(resetLevel, 2000);
                } else {
                    showFeedback('error', gameConfig.language === 'en' ? 'Try again!' : '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!');
                    highlightWrongLetters(answer, correctWord);
                    playSound('error');
                    updateAttemptsDisplay();
                }
            }
        }

        function highlightWrongLetters(answer, correct) {
            const slots = document.querySelectorAll('.bridge-slot');
            slots.forEach((slot, index) => {
                const block = slot.querySelector('.letter-block');
                if (block) {
                    if (answer[index] !== correct[index]) {
                        block.classList.add('wrong');
                    } else {
                        block.classList.add('correct');
                    }
                }
            });
        }

        function showFeedback(type, message) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
        }

        function animateBridgeBuild() {
            const slots = document.querySelectorAll('.bridge-slot');
            slots.forEach((slot, index) => {
                setTimeout(() => {
                    slot.style.background = 'linear-gradient(135deg, #8b4513, #a0522d)';
                    slot.style.border = '3px solid #654321';
                    slot.style.borderRadius = '10px';
                }, index * 200);
            });
        }

        function moveCharacter() {
            const character = document.getElementById('character');
            const progress = ((currentLevel + 1) / levels.length) * 90 + 5;
            character.style.left = `${progress}%`;
            
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${((currentLevel + 1) / levels.length) * 100}%`;
        }

        function startTimer() {
            updateTimerDisplay();
            
            timer = setInterval(() => {
                secondsLeft--;
                updateTimerDisplay();
                
                if (secondsLeft <= 0) {
                    clearInterval(timer);
                    showFeedback('error', gameConfig.language === 'en' ? 'Time is up!' : '–í—Ä–µ–º—è –≤—ã—à–ª–æ!');
                    setTimeout(resetLevel, 2000);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            document.getElementById('timerDisplay').textContent = 
                `${gameConfig.language === 'en' ? 'Time' : '–í—Ä–µ–º—è'}: ${secondsLeft}s`;
        }

        function resetAttempts() {
            attemptsLeft = gameConfig.attempts || 3;
            updateAttemptsDisplay();
        }

        function updateAttemptsDisplay() {
            const maxAttempts = gameConfig.attempts || 3;
            document.getElementById('attemptsDisplay').textContent = 
                `${gameConfig.language === 'en' ? 'Attempts' : '–ü–æ–ø—ã—Ç–∫–∏'}: ${attemptsLeft}/${maxAttempts}`;
        }

        function resetLevel() {
            loadLevel(currentLevel);
        }

        function showFinalScreen() {
            clearInterval(timer);
            
            const finalScreen = document.getElementById('finalScreen');
            finalScreen.classList.add('active');
            
            document.getElementById('totalWords').textContent = levels.length;
            document.getElementById('totalErrors').textContent = totalErrors;
            
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            document.getElementById('totalTime').textContent = `${minutes}–º ${seconds}—Å`;
            
            const prizeElement = document.getElementById('finalPrize');
            const prizes = {
                'medal': 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/medal.png',
                'treasure': 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/treasure.png',
                'certificate': 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/certificate.png',
                'castle': 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/ReadingPractice/main/castle.png'
            };
            
            prizeElement.style.backgroundImage = `url('${prizes[gameConfig.finalPrize]}')`;
        }

        function restartGame() {
            document.getElementById('finalScreen').classList.remove('active');
            initGame();
        }

        function playSound(type) {
            const sounds = {
                'success': 'https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3',
                'error': 'https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3'
            };
            
            const audio = document.getElementById('audioPlayer');
            audio.src = sounds[type];
            audio.play().catch(e => console.log('Audio play failed (user interaction needed):', e));
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        function updateMapPoints() {
            const mapPoints = document.getElementById('mapPoints');
            mapPoints.innerHTML = '';
            
            for (let i = 0; i < levels.length; i++) {
                const point = document.createElement('div');
                point.className = 'map-point';
                if (i < currentLevel) point.classList.add('completed');
                if (i === currentLevel) point.classList.add('active');
                point.dataset.level = i;
                point.addEventListener('click', () => jumpToLevel(i));
                mapPoints.appendChild(point);
            }
            
            updateLevelCounter();
        }

        function updateLevelCounter() {
            document.getElementById('levelCounter').textContent = `${currentLevel + 1}/${levels.length}`;
        }

        function jumpToLevel(level) {
            if (level <= currentLevel) {
                currentLevel = level;
                loadLevel(currentLevel);
            }
        }
    </script>
</body>
</html>
